stages:
  - build

minify_css:
  stage: build
  image: node:20
  rules:
    - changes:
        - nss.css
  script:
    - npm install -g clean-css-cli
    - cleancss -o nss.min.css nss.css
    - git config user.name "GitLab CI"
    - git config user.email "ci-bot@example.com"
    - git add nss.min.css
    - |
      if ! git diff --cached --quiet; then
        git commit -m "Auto-minified nss.css â†’ nss.min.css [skip ci]"
        # Use the CI_JOB_TOKEN for push authentication
        git push https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.com/${CI_PROJECT_PATH}.git HEAD:$CI_COMMIT_REF_NAME
      else
        echo "No changes to commit"
      fi
