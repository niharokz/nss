stages:
  - build

minify_css:
  stage: build
  image: node:20
  rules:
    - changes:
        - nss.css
  script:
    # 1. Install minifier
    - npm install -g clean-css-cli

    # 2. Minify CSS
    - cleancss -o nss.min.css nss.css

    # 3. Configure Git
    - git config user.name "GitLab CI"
    - git config user.email "ci-bot@example.com"

    # 4. Prepare commit
    - git add nss.min.css
    - |
      if ! git diff --cached --quiet; then
        git commit -m "Auto-minified nss.css â†’ nss.min.css [skip ci]"
        # 5. Configure non-interactive HTTPS credentials using the token
        git remote set-url origin https://gitlab-ci-token:${GIT_PUSH_TOKEN}@gitlab.com/${CI_PROJECT_PATH}.git
        # 6. Push commit
        git push origin HEAD:$CI_COMMIT_REF_NAME
      else
        echo "No changes to commit"
      fi
